<div class="container">
  <div class="header">
    <div class="header-left">
      <button mat-icon-button (click)="goToHome()" class="back-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h2>Caja Diaria</h2>
    </div>
  </div>

  <div *ngIf="isAdmin" class="summary-cards">
    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title>Total Ventas del Día</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <h3>{{totalDailySales | currency}}</h3>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title>Total Comisiones</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <h3>{{totalCommissions | currency}}</h3>
      </mat-card-content>
    </mat-card>
  </div>

  <div *ngIf="isAdmin" class="commission-table">
    <h3>Comisiones por Usuario</h3>
    <p class="table-hint">Haga clic en una fila para ver los detalles de ventas</p>
    <mat-table [dataSource]="dataSource" class="mat-elevation-z8">
      <ng-container matColumnDef="user">
        <mat-header-cell *matHeaderCellDef> Usuario </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.user}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="sales">
        <mat-header-cell *matHeaderCellDef> Ventas </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.sales | currency}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="commission">
        <mat-header-cell *matHeaderCellDef> Comisión </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.commission | currency}} </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;" (click)="openSalesDetailsDialog(row)" class="clickable-row"></mat-row>
    </mat-table>
  </div>

  <div *ngIf="!isAdmin" class="user-commission">
    <div class="summary-cards">
      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>Tus Ventas del Día</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <h3>{{userSales | currency}}</h3>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>Tu Comisión del Día</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <h3>{{userCommission | currency}}</h3>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Product Ranking Section - Solo para Administradores -->
  <div class="product-ranking-section" *ngIf="isAdmin">
    <h3>Ranking de Productos</h3>
    
    <!-- Product Ranking Controls -->
    <div class="ranking-controls">
      <mat-form-field appearance="outline">
          <mat-label>Fecha Desde</mat-label>
          <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDate" (dateChange)="onStartDateChange()">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>
      
      <mat-form-field appearance="outline">
          <mat-label>Fecha Hasta</mat-label>
          <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate" [min]="startDate" (dateChange)="onDateRangeChange()">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>
    </div>

    <!-- Product Ranking Table -->
    <mat-table [dataSource]="productRankingDataSource" class="mat-elevation-z8 ranking-table">
      <ng-container matColumnDef="ranking">
        <mat-header-cell *matHeaderCellDef> # </mat-header-cell>
        <mat-cell *matCellDef="let element" class="ranking-cell">
          <span class="ranking-badge" [ngClass]="{
            'top-1': element.ranking === 1,
            'top-2': element.ranking === 2,
            'top-3': element.ranking === 3
          }">
            {{element.ranking}}
          </span>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="product">
        <mat-header-cell *matHeaderCellDef> Producto </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.product.name}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="quantity">
        <mat-header-cell *matHeaderCellDef> Cantidad Vendida </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.totalQuantitySold}} </mat-cell>
      </ng-container>



      <ng-container matColumnDef="orders">
        <mat-header-cell *matHeaderCellDef> Órdenes </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.totalOrders}} </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="productRankingColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: productRankingColumns;"></mat-row>
    </mat-table>
  </div>
</div>